/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v2.5.0
 */
"use strict";$(function(){var u,c=null;({init:function(){""==document.referrer&&(localStorage.setItem("sid",""),localStorage.setItem("token",""),this.clearLocalStorage(),localStorage.removeItem("bindcardData"),localStorage.removeItem("bindStudentData"),localStorage.removeItem("zoom"),localStorage.removeItem("PresentationStep")),(u=this).UIInit(),u.$connection.hide(),u.$screen.hide(),u.showLoading("正在连接爱智慧岛课堂..."),u.sid=localStorage.getItem("sid"),u.token=localStorage.getItem("token"),u.sid&&u.token?u.webSocketInit():location.href="./index.html?from=class&v="+CONFIG.version,u.heartCount=0,$(window).unbind("resize"),$(window).on("resize",function(){localStorage.getItem("picUrl")?u.showImage(localStorage.getItem("answerType"),localStorage.getItem("isAnswer"),localStorage.getItem("picUrl"),localStorage.getItem("htmlUrl"),""):(u.$connection.fadeIn(200),u.$screen.fadeIn(200),u.$loading.fadeOut(200)),u.showSessionMask()}),window.addEventListener("message",function(e){console.log(e),localStorage.setItem("PresentationStep",e.data),console.log("PresentationStep: ",localStorage.getItem("PresentationStep"))},!1)},UIInit:function(){u.audioCurrenttimeTimeout,u.$course=$("#course"),u.$connection=$("#connection"),u.$loading=$("#loading"),u.$screen=$("#screen"),u.$courseImg=$("#courseImg"),u.$courseIframe=$("#courseIframe"),u.$audioBox=$("#audioBox"),u.$audio=$("#audio"),u.$toolbar=$("#toolbar"),u.$buttonVoice=$("#button-voice"),u.$buttonVoice.hide(),u.$buttonRefresh=$("#button-refresh"),u.$buttonFullscreen=$("#button-fullscreen"),u.$bindcard=$("#bindcard"),u.$bindlist=$("#bindlist"),u.checkBrowserAutoPlayAudio().then(function(e){e?(u.$buttonVoice.addClass("voice-on").show(),u.$audioBox.find(".audiotips").hide(),document.getElementById("audio").removeAttribute("mute")):(u.$buttonVoice.removeClass("voice-on").show(),u.$audioBox.find(".audiotips").show(),document.getElementById("audio").muted=!0)}),u.$buttonVoice.unbind("click"),u.$buttonVoice.on("click",u.buttonVoiceBind),u.$buttonRefresh.unbind("click"),u.$buttonRefresh.on("click",u.buttonRefreshBind),u.$buttonFullscreen.unbind("click"),u.$buttonFullscreen.on("click",u.buttonFullscreenBind)},webSocketInit:function(){"WebSocket"in window?c=new WebSocket("ws://"+CONFIG.online):alert("当前浏览器不支持 webSocket, 请更换最新版谷歌浏览器！"),c.onopen=function(){console.log("WebSocket连接成功"),u.sendHeartMsg(),u.sendMsg({bizType:10002,sid:u.sid,token:u.token,data:{loginType:2}})},c.onmessage=function(e){u.doReceiveMsg(e.data)},c.onclose=function(){console.log("WebSocket连接关闭"),c.close(),c=null,"tick"==u.closeType||(u.$screen.hide(),u.showLoading("连接已断开，正在重新连接，请稍候"),u.webSocketInit())},window.onbeforeunload=function(){u.sendMsg({bizType:10011,sid:u.sid,token:u.token,data:{opType:1001101}}),c.close()}},clearLocalStorage:function(){localStorage.removeItem("sessionType"),localStorage.removeItem("picUrl"),localStorage.removeItem("htmlUrl"),localStorage.removeItem("htmlPicList"),localStorage.removeItem("answerType"),localStorage.removeItem("isAnswer"),localStorage.removeItem("timeClock"),localStorage.removeItem("answerNum"),localStorage.removeItem("answerCharts"),localStorage.removeItem("answerStudent"),localStorage.removeItem("unAnswerStudent"),localStorage.removeItem("canvasData"),localStorage.removeItem("audioTime"),localStorage.removeItem("scale"),localStorage.removeItem("audioStatus"),$(".imgbox").removeAttr("style"),$(".canvas").removeAttr("style")},sendHeartMsg:function(){setInterval(function(){u.heartCount<3?u.sendMsg({bizType:10006,data:{}}):location.href=location.href},5e3)},doReceiveMsg:function(e){if(-1==(e=JSON.parse(e)).code);else if(10001==e.code)u.sendMsg({bizType:10001,data:{}});else if(10002==e.code)localStorage.getItem("picUrl")?u.showImage(localStorage.getItem("answerType"),localStorage.getItem("isAnswer"),localStorage.getItem("picUrl"),localStorage.getItem("htmlUrl"),""):(u.$connection.fadeIn(200),u.$screen.fadeIn(200),u.$loading.fadeOut(200)),u.showSessionMask();else if(10006==e.code)u.heartCount-=1;else if(10007==e.code)u.closeType="tick",c.close(),alert("您的账号已在其它地点登录，将被强制下线！"),location.href="./index.html?from=class&v="+CONFIG.version;else if(10014==e.code){var t=document.getElementById("audio");switch(e.data.opType){case 1:t.play(),localStorage.setItem("audioStatus","1");break;case 2:t.pause(),localStorage.setItem("audioStatus","2");break;case 3:t.currentTime=0,u.setStorageAudioTime(0),u.sendAudioMsg(1),t.play(),localStorage.setItem("audioStatus","1");break;case 4:t.currentTime>t.duration-parseInt(e.data.seconds)?t.currentTime=t.duration:t.currentTime=t.currentTime+parseInt(e.data.seconds),u.setStorageAudioTime(t.currentTime),u.sendAudioMsg(1),t.play(),localStorage.setItem("audioStatus","1");break;case 5:t.currentTime<parseInt(e.data.seconds)?t.currentTime=0:t.currentTime=t.currentTime-parseInt(e.data.seconds),u.setStorageAudioTime(t.currentTime),u.sendAudioMsg(1),t.play(),localStorage.setItem("audioStatus","1");break;default:return}}else if(10015==e.code)1==e.data.pptOpType?(u.usePresentation(1),setTimeout(function(){u.usePresentation(3)},200),u.sendMsg({bizType:10015,sid:u.sid,token:u.token,data:{sourceType:"web",pptOpType:1}})):2==e.data.pptOpType&&(u.usePresentation(2),setTimeout(function(){u.usePresentation(3)},200),u.sendMsg({bizType:10015,sid:u.sid,token:u.token,data:{sourceType:"web",pptOpType:2}}));else if(80002==e.code)this.clearLocalStorage(),u.$connection.fadeIn(200),u.$screen.find("#canvas").remove(),u.$screen.find(".state-before").remove(),u.$screen.find(".state-doing").remove(),u.$screen.find(".state-after").remove(),u.$screen.find(".chart").remove(),u.$screen.find(".student").remove(),u.$screen.find(".unAnswer-student").remove(),u.$courseImg.hide(),$("#courseIframe").remove(),u.$audioBox.hide(),document.getElementById("audio").src="",u.$buttonVoice.hide(),u.$screen.fadeIn(200),u.$loading.fadeOut(200);else if(80003==e.code)clearInterval(u.audioCurrenttimeTimeout),localStorage.removeItem("zoom"),localStorage.removeItem("PresentationStep"),localStorage.setItem("sessionType","0"),e.data.picHtmlArray?(this.clearLocalStorage(),u.showImage(e.data.answerType,e.data.isAnswer,e.data.picUrl,e.data.htmlUrl,e.data.picHtmlArray)):u.showImage(e.data.answerType,e.data.isAnswer,e.data.picUrl,e.data.htmlUrl,"");else if(80004==e.code)localStorage.setItem("sessionType","2"),u.$screen.find(".state-before").remove(),u.$screen.find(".state-after").remove(),u.$screen.find(".chart").remove(),u.startAnswer();else if(80005==e.code)localStorage.setItem("sessionType","3"),u.endAnswer();else if(80006==e.code)localStorage.setItem("sessionType","4"),localStorage.setItem("answerCharts",JSON.stringify(e.data.answerInfo)),u.showAnswerCharts();else if(80007==e.code)localStorage.setItem("sessionType","5"),localStorage.setItem("answerStudent",JSON.stringify(e.data)),u.showStudent();else if(80008==e.code)localStorage.setItem("answerNum",e.data.answerNum),u.$screen.find(".state-doing .text-number .number").html("答题人数："+e.data.answerNum+"人");else if(80009==e.code)localStorage.setItem("sessionType","3"),u.$screen.find(".chart").remove(),u.endAnswer();else if(80010==e.code)localStorage.setItem("sessionType","4"),u.$screen.find(".student").remove(),u.showAnswerCharts();else if(80011==e.code)u.closeType="tick",c.close(),location.href="./index.html?from=class&v="+CONFIG.version;else if(80013==e.code)localStorage.setItem("sessionType","80"),localStorage.setItem("bindcardData",JSON.stringify(e.data)),u.showBindCard();else if(80014==e.code)localStorage.setItem("sessionType","80"),localStorage.setItem("bindStudentData",JSON.stringify(e.data)),u.showBindStudent();else if(80015==e.code)u.$bindcard.removeClass("bindcard-active").hide(),u.$connection.fadeIn(300);else if(80016==e.code){var a=JSON.parse(localStorage.getItem("bindcardData"));a.stuNum=e.data.stuNum,localStorage.setItem("bindcardData",JSON.stringify(a)),u.$bindcard.find(".card-info span").html(e.data.stuNum)}else if(80017==e.code){var o=[];if(localStorage.getItem("canvasData")){o=JSON.parse(localStorage.getItem("canvasData"));for(var n=0;n<o.length;n++)if(o[n].picUrl==localStorage.getItem("picUrl"))return void u.canvasInit()}else o=[];o.push({picUrl:localStorage.getItem("picUrl"),data:{width:e.data.initData.width,height:e.data.initData.height}}),localStorage.setItem("canvasData",JSON.stringify(o)),u.canvasInit()}else if(80018==e.code){o=JSON.parse(localStorage.getItem("canvasData"));var s=e.data.points[0],r=localStorage.getItem("picUrl");for(n=0;n<o.length;n++)if(o[n].picUrl==r){var i=o[n].data;if(i.lines){for(var l=0;l<i.lines.length;l++)if(i.lines[l].lineId==s.lineId)return i.lines[l].location||(i.lines[l].location=[]),i.lines[l].location.push({x:s.x,y:s.y}),localStorage.setItem("canvasData",JSON.stringify(o)),void u.drawCanvas();return i.lines.push({lineId:s.lineId,color:s.color,isEraser:s.isEraser,location:[{x:s.x,y:s.y}]}),localStorage.setItem("canvasData",JSON.stringify(o)),void u.drawCanvas()}return i.lines=[],i.lines.push({lineId:s.lineId,color:s.color,isEraser:s.isEraser,location:[{x:s.x,y:s.y}]}),localStorage.setItem("canvasData",JSON.stringify(o)),void u.drawCanvas()}}else if(80019==e.code)localStorage.setItem("zoom",JSON.stringify(e.data.zoomObj)),u.zoomAndMove();else if(80020==e.code)for(o=JSON.parse(localStorage.getItem("canvasData")),r=localStorage.getItem("picUrl"),n=0;n<o.length;n++){if(o[n].picUrl==r)o[n].data.lines=[],localStorage.setItem("canvasData",JSON.stringify(o)),document.getElementById("canvas").getContext("2d").clearRect(0,0,$("#canvas").width(),$("#canvas").height())}else 80021==e.code?(localStorage.setItem("sessionType","6"),localStorage.setItem("unAnswerStudent",JSON.stringify(e.data)),u.$screen.find(".state-doing").hide(),u.showUnAnswerStudent()):80022==e.code&&(u.$screen.find(".unAnswer-student").remove(),u.$screen.find(".state-doing").show(),localStorage.setItem("sessionType","2"),u.$screen.find(".state-before").remove(),u.$screen.find(".state-after").remove(),u.$screen.find(".chart").remove(),u.startAnswer())},sendMsg:function(e){c.send(JSON.stringify(e))},showImage:function(e,t,a,o,n){if(a!=localStorage.getItem("picUrl")&&(localStorage.setItem("audioStatus","2"),u.sendAudioMsg(2),u.showTipsText("暂停中...")),localStorage.setItem("picUrl",a),localStorage.setItem("htmlUrl",o),localStorage.setItem("answerType",e),localStorage.setItem("isAnswer",t?"true":""),u.$connection.hide(),u.$screen.hide(),u.$courseImg.hide(),$("#courseIframe").remove(),u.$screen.find("#canvas").remove(),u.$screen.find(".state-before").remove(),u.$screen.find(".state-doing").remove(),u.$screen.find(".state-after").remove(),u.$screen.find(".chart").remove(),u.$screen.find(".student").remove(),u.$screen.find(".unAnswer-student").remove(),document.getElementById("audio").src="",u.$audioBox.hide(),u.showLoading("正在同步显示手机屏幕，请稍候"),localStorage.getItem("zoom")&&u.zoomAndMove(),o){u.$buttonVoice.fadeOut(200);var s=document.createElement("iframe");s.id="iframe",s.src=o,s.style.display="none",s.attachEvent?s.attachEvent("onload",function(){u.afterShowImage(),$("#iframe").remove(),$("#courseIframe").show(),u.showPresentation(),u.preloadImageHtml(a,o,n)}):s.onload=function(){u.afterShowImage(),$("#iframe").remove(),$("#courseIframe").show(),u.showPresentation(),u.preloadImageHtml(a,o,n)},u.$screen.find(".imgbox").append('<iframe width="100%" height="100%" src="'+o+'" name="courseIframe" id="courseIframe" style="display: none;"></iframe>'),document.body.appendChild(s)}else{var r=a.split(".");if("mp3"==r[r.length-1])u.$buttonVoice.fadeIn(200),document.getElementById("audio").src=a,u.handleAudioEvents();else{u.$buttonVoice.fadeOut(200);var i,l,c=new Image,d=window.innerWidth,m=window.innerHeight-42;"number"!=typeof d&&(m="CSS1Compat"==document.compatMode?(d=document.documentElement.clientWidth,document.documentElement.clientHeight-42):(d=document.body.clientWidth,document.body.clientHeight-42)),i=d/m,c.crossOrigin="anonymous",c.onload=function(e){EXIF.getData(c,function(){l=EXIF.getTag(this,"Orientation");var e=c.width,t=c.height;switch(l){case void 0:case 1:i<e/t?u.$courseImg.css({width:"100%",height:"auto","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(0deg)",transform:"translate3d(-50%, -50%, 0) rotate(0deg)"}):u.$courseImg.css({width:"auto",height:"100%","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(0deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(0deg)",transform:"translate3d(-50%, -50%, 0) rotate(0deg)"});break;case 3:i<e/t?u.$courseImg.css({width:"100%",height:"auto","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)",transform:"translate3d(-50%, -50%, 0) rotate(-180deg)"}):u.$courseImg.css({width:"auto",height:"100%","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-180deg)",transform:"translate3d(-50%, -50%, 0) rotate(-180deg)"});break;case 6:i<t/e?u.$courseImg.css({width:"auto",height:d,"-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)",transform:"translate3d(-50%, -50%, 0) rotate(-270deg)"}):u.$courseImg.css({width:m,height:"auto","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-270deg)",transform:"translate3d(-50%, -50%, 0) rotate(-270deg)"});break;case 8:i<t/e?u.$courseImg.css({width:"auto",height:d,"-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)",transform:"translate3d(-50%, -50%, 0) rotate(-90deg)"}):u.$courseImg.css({width:m,height:"auto","-webkit-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-moz-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-ms-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)","-o-transform":"translate3d(-50%, -50%, 0) rotate(-90deg)",transform:"translate3d(-50%, -50%, 0) rotate(-90deg)"})}u.$courseImg.attr("src",a).show(),u.afterShowImage(),u.preloadImageHtml(a,o,n)})},c.src=a}}},preloadImageHtml:function(e,t,a){a&&0<a.length&&localStorage.setItem("htmlPicList",a);var o=localStorage.getItem("htmlPicList"),n=0,s=(o=o.split(",")).length,r=[];n=t?o.indexOf(t):o.indexOf(e),s<7?r=o:n<3?(r.push(o[0]),r.push(o[1]),r.push(o[2]),r.push(o[3]),r.push(o[4])):s-3<n?(r.push(o[s-1]),r.push(o[s-2]),r.push(o[s-3]),r.push(o[s-4]),r.push(o[s-5])):(r.push(o[n-3]),r.push(o[n-2]),r.push(o[n-1]),r.push(o[n]),r.push(o[n+1]),r.push(o[n+2]),r.push(o[n+3]));for(var i=0;i<r.length;i++){var l=r[i],c=o.indexOf(l),d=l.split("."),m=d[d.length-1];if("html"==m){if(0==$("#iframe-"+c).length){var u=document.createElement("iframe");u.id="iframe-"+c,u.src=r[i],u.style.display="none",document.body.appendChild(u)}}else if("mp3"==m);else{(new Image).src=l}}},preloadImages:function(e){for(var t=[],a=0;a<e.length;a++){var o=e[a].split(".");"mp3"==o[o.length-1]||(t[a]=new Image,t[a].src=e[a])}},preloadHtmls:function(e){for(var t=0;t<e.length;t++)if(e[t]){var a=document.createElement("iframe");a.id="iframe-"+t,a.src=e[t],a.style.display="none",document.body.appendChild(a)}},showPresentation:function(){localStorage.getItem("PresentationStep")&&setTimeout(function(){var e=parseInt(localStorage.getItem("PresentationStep"))+1;u.usePresentation(5,e)},500)},usePresentation:function(e,t){var a={type:e,step:t||""};document.getElementById("tmp_iframe").contentWindow.postMessage(JSON.stringify(a),"*")},handleAudioEvents:function(){var e=document.getElementById("audio");e.onloadedmetadata=function(){u.getStorageAudioTime()&&(e.currentTime=u.getStorageAudioTime()),u.showDuration(e.duration),u.showCurrentTime(e.currentTime),u.setStorageAudioTime(e.currentTime),u.$audioBox.find(".progress-bar").css("width",e.currentTime/e.duration*100+"%"),clearInterval(u.audioCurrenttimeTimeout),u.audioCurrenttimeTimeout=setInterval(function(){u.showCurrentTime(e.currentTime),u.setStorageAudioTime(e.currentTime),u.$audioBox.find(".progress-bar").css("width",e.currentTime/e.duration*100+"%")},1e3),u.sendAudioMsg(2),"1"==localStorage.getItem("audioStatus")&&e.play(),u.$audioBox.show(),u.afterShowImage()},e.onplay=function(){u.sendAudioMsg(1),u.showTipsText("正在播放中...")},e.onpause=function(){u.sendAudioMsg(2),u.showTipsText("暂停中...")},e.onended=function(){e.currentTime=0,u.setStorageAudioTime(0),u.sendAudioMsg(2),u.showTipsText("播放结束...")}},checkBrowserAutoPlayAudio:function(){return new Promise(function(e){var t=document.createElement("audio");t.src="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",document.body.appendChild(t);var a=!0;t.play().then(function(){a=!0}).catch(function(e){a=!1}).finally(function(){t.remove(),e(a)})})},sendAudioMsg:function(e){u.sendMsg({bizType:10014,sid:u.sid,token:u.token,data:{sourceType:"web",mediaType:"audio",opType:e}})},setStorageAudioTime:function(e){var t=localStorage.getItem("picUrl"),a=JSON.parse(localStorage.getItem("audioTime"));if(a){for(var o=0;o<a.length;o++)if(t==a[o].picUrl)return a[o].time=e,localStorage.setItem("audioTime",JSON.stringify(a)),!1;return a.push({picUrl:t,time:e}),localStorage.setItem("audioTime",JSON.stringify(a)),!1}return(a=new Array).push({picUrl:t,time:e}),localStorage.setItem("audioTime",JSON.stringify(a)),!1},getStorageAudioTime:function(){var e,t=localStorage.getItem("picUrl"),a=JSON.parse(localStorage.getItem("audioTime"));if(a)for(var o=0;o<a.length;o++)t==a[o].picUrl&&(e=a[o].time);else e=0;return e},afterShowImage:function(){u.$loading.fadeOut(200),u.$screen.fadeIn(200),localStorage.getItem("sessionType")&&"0"!=localStorage.getItem("sessionType")||u.showProblem(),u.canvasInit()},showTipsText:function(e){u.$audioBox.find(".text").html(e)},showDuration:function(e){u.$audioBox.find(".duration-time").html(u.concatMinuteSecond(e))},showCurrentTime:function(e){u.$audioBox.find(".current-time").html(u.concatMinuteSecond(e))},showSessionMask:function(){if(!localStorage.getItem("sessionType"))return!1;switch(parseInt(localStorage.getItem("sessionType"))){case 0:break;case 2:u.startAnswer();break;case 3:u.endAnswer();break;case 4:u.showAnswerCharts();break;case 5:u.showStudent();break;case 6:u.showUnAnswerStudent();break;case 80:u.showBindCard();break;case 81:u.showBindStudent();break;default:return}},showProblem:function(){var e=parseInt(localStorage.getItem("answerType"));if(0!=e)if(localStorage.getItem("isAnswer")){'<div class="state-after">','<div class="button-detail">查看结果</div>','<p class="text">重新答题</p>',"</div>",u.$screen.append('<div class="state-after"><div class="button-detail">查看结果</div><p class="text">重新答题</p></div>')}else switch(e){case 1:u.$screen.append('<div class="state-before">答题(单选)</div>');break;case 2:u.$screen.append('<div class="state-before">答题(多选)</div>');break;case 3:u.$screen.append('<div class="state-before">答题(判断)</div>');break;default:u.$screen.append("")}},startAnswer:function(){var e,t="";t+='<div class="state-doing">',t+='<p class="text text-time">答题时间：00:'+(e=localStorage.getItem("timeClock")?JSON.parse(localStorage.getItem("timeClock")):{minutes:"00",seconds:"00"}).minutes+":"+e.seconds+"</p>",t+='<p class="text text-number clearfix"><span class="number">答题人数：'+localStorage.getItem("answerNum")+'人</span><span class="btn-unAnswer">未答</span></p>',t+='<div class="button-stop">结束答题</div>',t+="</div>",u.$screen.find(".state-doing").remove(),u.$screen.append(t),u.timeClock()},endAnswer:function(){clearInterval(u.XF),localStorage.removeItem("timeClock"),u.$screen.find(".state-before").remove(),u.$screen.find(".state-doing").remove(),u.$screen.find(".state-after").remove(),u.$screen.append('<div class="state-after"><div class="button-detail">查看结果</div><p class="text">重新答题</p></div>')},showAnswerCharts:function(){var e=JSON.parse(localStorage.getItem("answerCharts")),t=[],a=[];if(3==e.answerType)t=["✓","✕","误按","未答题"],a=[{value:e.numTrue,width:"",bgcolor:"#38A0FF"},{value:e.numFalse,width:"",bgcolor:"#FFFD38"},{value:e.wrongNum,width:"",bgcolor:"#D9D9D9"},{value:e.giveupNum,width:"",bgcolor:"#D9D9D9"}],"0"==e.answer||0==e.answer?a[1].bgcolor="#1EC51D":"1"!=e.answer&&1!=e.answer||(a[0].bgcolor="#1EC51D");else if(1==e.answerType){t=["A","B","C","D","E","F","误按","未答题"],(a=[{value:e.numA,width:"",bgcolor:"#38A0FF"},{value:e.numB,width:"",bgcolor:"#FFFD38"},{value:e.numC,width:"",bgcolor:"#D71616"},{value:e.numD,width:"",bgcolor:"#D68A16"},{value:e.numE,width:"",bgcolor:"#7A38FF"},{value:e.numF,width:"",bgcolor:"#C238FF"},{value:e.wrongNum,width:"",bgcolor:"#D9D9D9"},{value:e.giveupNum,width:"",bgcolor:"#D9D9D9"}])[t.indexOf(e.answer)].bgcolor="#1EC51D"}else 2==e.answerType&&(t=["答对","答错","未答题"],a=[{value:e.rightNum,width:"",bgcolor:"#1EC51D"},{value:e.totalWrongNum,width:"",bgcolor:"#D9D9D9"},{value:e.giveupNum,width:"",bgcolor:"#D9D9D9"}]);for(var o=[],n=0;n<a.length;n++)o.push(a[n].value);o.sort(u.compare);for(var s=o.pop(),r=0;r<a.length;r++)a[r].width=parseInt(a[r].value)/parseInt(s)*90;var i="";i+='<div class="chart">',i+='<div class="chart-box flex-h">',i+='<div class="time">答题时间：00:'+u.transMinute(Math.floor(e.costTime/60))+":"+u.transSecond(e.costTime%60)+"&nbsp;&nbsp;&nbsp;&nbsp;答案："+e.answer+"</div>",i+='<div class="titles">';for(var l=0;l<t.length;l++)i+='<p class="titles-item">'+t[l]+"</p>";i+="</div>",i+='<div class="options flex-a-i">';for(var c=0;c<a.length;c++)i+='<div class="options-item flex-h">',i+='<p class="color-line" style="width: '+a[c].width+"%; background: "+a[c].bgcolor+';"></p>',i+='<p class="text">'+a[c].value+"人</p>",i+="</div>";i+="</div>",i+="</div>",i+="</div>",u.$screen.find(".state-after").remove(),u.$screen.append(i)},showStudent:function(){var e=JSON.parse(localStorage.getItem("answerStudent")),t="";switch(parseInt(e.answerType)){case 0:t="选择✕的学生";break;case 1:t="选择✓的学生";break;case 2:t="选择"+e.rightAnswer+"的学生";break;case 3:t="答错的学生";break;case 4:t="未答题的学生";break;case 7:t="误按的学生";break;default:t="选择"+e.answerType+"的学生"}var a="";a+='<div class="student">',a+='<div class="student-box">',a+="<h2>"+t+"</h2>",a+='<div class="s-list">';for(var o=0;o<e.studentList.length;o++)e.studentList[o].name?0==e.studentList[o].status?a+="<p>"+e.studentList[o].name+"</p>":3==e.answerType?a+='<p class="grey ">'+e.studentList[o].name+'<br /><span class="answear">'+e.studentList[o].answer+"<span></p>":a+='<p class="grey">'+e.studentList[o].name+"</p>":0==e.studentList[o].status?a+="<p>&nbsp;</p>":a+='<p class="grey">&nbsp;</p>';a+="</div>",a+="</div>",a+="</div>",u.$screen.find(".chart").remove(),u.$screen.append(a)},showUnAnswerStudent:function(){var e=JSON.parse(localStorage.getItem("unAnswerStudent")),t="";if(0==e.studentList.length)t+='<div class="unAnswer-student">',t+='<div class="no-list">全部回答完毕</div>',t+="</div>";else{t+='<div class="unAnswer-student">',t+='<div class="student-box">',t+="<h2>尚未答题学生</h2>";for(var a=0;a<e.studentList.length;a++)e.studentList[a].name?0==e.studentList[a].status?t+="<p>"+e.studentList[a].name+"</p>":t+='<p class="grey">'+e.studentList[a].name+"</p>":0==e.studentList[a].status?t+="<p>&nbsp;</p>":t+='<p class="grey">&nbsp;</p>';t+="</div>",t+="</div>"}u.$screen.find(".state-after").remove(),u.$screen.append(t),u.timeClock()},showBindCard:function(){var e=JSON.parse(localStorage.getItem("bindcardData")),t=["A","B","C","D","E","F","","1","0"],a=e.code.split(""),o=u.$bindcard.find(".card-header .card-item"),n=u.$bindcard.find(".card-main .card-item");n.removeClass("selected");for(var s=0;s<a.length;s++){"0"==a[s]?o.eq(s).html("✕"):"1"==a[s]?o.eq(s).html("✓"):o.eq(s).html(a[s]);var r=t.indexOf(a[s]);n.eq(r).addClass("selected")}u.$bindcard.find(".card-info span").html(e.stuNum),u.$bindcard.show();var i=u.$bindcard.height()/1200;u.$bindcard.find(".bindcard-box").css({"-webkit-transform":"translate3d(-50%, -50%, 0) scale("+i+")","-moz-transform":"translate3d(-50%, -50%, 0) scale("+i+")","-ms-transform":"translate3d(-50%, -50%, 0) scale("+i+")",transform:"translate3d(-50%, -50%, 0) scale("+i+")"}),window.showBindStudentXF=setInterval(function(){u.showBindStudent()},30)},showBindStudent:function(){var e=localStorage.getItem("bindStudentData");if(!e)return!1;var t=JSON.parse(e);if(t.studentList&&0<t.studentList.length){for(var a="",o=0;o<t.studentList.length;o++)t.studentList[o].name?0==t.studentList[o].status?a+='<li class="list-item">'+t.studentList[o].name+"</li>":a+='<li class="list-item grey">'+t.studentList[o].name+"</li>":0==t.studentList[o].status?a+='<li class="list-item">&nbsp;</li>':a+='<li class="list-item grey">&nbsp;</li>';u.$bindlist.find("ul").html(a)}else u.$bindlist.find("ul").html('<li class="no-data">暂无绑定的学生</li>');clearInterval(window.showBindStudentXF),u.$connection.hide(),u.$bindcard.addClass("bindcard-active").fadeIn(300)},showLoading:function(e){u.$loading.find(".text").html(e),u.$loading.fadeIn(200)},timeClock:function(){if(clearInterval(u.XF),localStorage.getItem("timeClock")){var e=JSON.parse(localStorage.getItem("timeClock")),t=parseInt(e.minutes),a=parseInt(e.seconds);u.clock=60*t+a}else u.clock=0,u.seconds=0,u.minutes=0;u.XF=setInterval(function(){u.clock+=1,u.seconds=u.clock%60,u.minutes=Math.floor(u.clock/60);var e={minutes:u.transMinute(u.minutes),seconds:u.transSecond(u.seconds)};u.$screen.find(".state-doing .text-time").html("答题时间：00:"+e.minutes+":"+e.seconds),localStorage.setItem("timeClock",JSON.stringify(e))},1e3)},canvasInit:function(){localStorage.getItem("picUrl");var e=JSON.parse(localStorage.getItem("canvasData"));if(!e)return!1;for(var t=0;t<e.length;t++)if(e[t].picUrl==localStorage.getItem("picUrl")){var a,o=e[t].data,n=o.width,s=o.height,r=window.innerWidth,i=window.innerHeight-42;return"number"!=typeof r&&(i="CSS1Compat"==document.compatMode?(r=document.documentElement.clientWidth,document.documentElement.clientHeight-42):(r=document.body.clientWidth,document.body.clientHeight-42)),r/i<$("#courseImg").width()/$("#courseImg").height()?(a=r/n,n=r,s*=a):(n*=a=i/s,s=i),localStorage.setItem("scale",a),void u.createCanvas(n,s)}},createCanvas:function(e,t){$(".canvas").html('<canvas id="canvas" width="'+e+'" height="'+t+'"></canvas>'),u.drawCanvas()},drawCanvas:function(){localStorage.getItem("picUrl");var e=JSON.parse(localStorage.getItem("canvasData")),t=document.getElementById("canvas").getContext("2d");t.clearRect(0,0,$("#canvas").width(),$("#canvas").height());for(var a=0;a<e.length;a++)if(e[a].picUrl==localStorage.getItem("picUrl")){var o=e[a].data.lines,n=localStorage.getItem("scale");if(!o)return!1;t.lineCap="round",t.lineJoin="round";for(var s=0;s<o.length;s++){var r=o[s].color,i=o[s].isEraser,l=o[s].location;"-2681322"==r?r="#D71616":"-13065985"==r&&(r="#38A0FF"),i?(t.globalCompositeOperation="destination-out",t.lineWidth=40*parseFloat(localStorage.getItem("scale"))):(t.globalCompositeOperation="source-over",t.lineWidth=4*parseFloat(localStorage.getItem("scale"))),t.beginPath(),t.strokeStyle=r;for(var c=0;c<l.length-1;c++)t.moveTo(parseFloat(l[c].x)*n,parseFloat(l[c].y)*n),t.lineTo(parseFloat(l[c+1].x)*n,parseFloat(l[c+1].y)*n);t.closePath(),t.stroke()}return}},zoomAndMove:function(){var e=JSON.parse(localStorage.getItem("zoom")),t=e.translateX/e.width/e.zoom*100,a=e.translateY/e.height/e.zoom*100;$(".imgbox").css({"-webkit-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-moz-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-ms-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-o-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)",transform:"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)"}),$(".canvas").css({"-webkit-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-moz-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-ms-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)","-o-transform":"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)",transform:"scale("+e.zoom+") translate3d("+t+"%, "+a+"%, 0)"})},transMinute:function(e){return e<10?"0"+e:e},transSecond:function(e){return e<10?"0"+e:e},concatMinuteSecond:function(e){e=parseInt(e);var t=Math.floor(e/60),a=e%60;return u.transMinute(t)+":"+u.transSecond(a)},compare:function(e,t){return e<t?-1:t<e?1:0},buttonVoiceBind:function(){var e=document.getElementById("audio");if(u.$buttonVoice.hasClass("voice-on"))u.$buttonVoice.removeClass("voice-on"),e.muted=!0,u.$audioBox.find(".audiotips").fadeIn(200);else{e=document.getElementById("audio");u.$buttonVoice.addClass("voice-on"),u.$audioBox.find(".audiotips").fadeOut(200),e.muted=!1}},buttonRefreshBind:function(){location.href=location.href},buttonFullscreenBind:function(){u.isFullscreenForNoScroll()?u.cancleFullscreen():u.launchFullscreen(document.documentElement)},launchFullscreen:function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},cancleFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},isFullscreenForNoScroll:function(){return 0<window.navigator.userAgent.toLowerCase().indexOf("chrome")?document.body.scrollHeight===window.screen.height&&document.body.scrollWidth===window.screen.width:window.outerHeight===window.screen.height&&window.outerWidth===window.screen.width}}).init()});